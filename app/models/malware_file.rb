class MalwareFile < ActiveRecord::Base
  require 'CSV'

  validates :md5, :classification_name, :classification_type, :size, :file_type,  presence: true

  def self.import(file)
    CSV.foreach(file.path, headers: true) do |row|
      malware_file_hash = row.to_hash
      normalized_hash  = normalize_keys(malware_file_hash)
    end
  end

  def self.normalize_keys(hash)
    hash.keys.each do |key|
      if camel_case?(key)
        normailzed_key = camel_case_to_snake_case(key)
      else
        key.downcase
      end
    end
  end

  def self.camel_case?(key)
    key.match(/^[A-Z]{1}[a-z]+[A-Z]{1}/) != nil
  end

  def self.camel_case_to_snake_case(key)
    key.chars.each_with_index.map do |letter, index|
      letter == letter.upcase && index != 0 ? "_#{letter}" : letter
    end.join('').downcase
  end
end
